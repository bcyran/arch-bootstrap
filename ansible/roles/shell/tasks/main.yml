---
- name: Install shell-related pacman packages
  pacman:
    name: "{{ packages.shell.pacman }}"

- name: Install shell-related AUR packages
  kewlfft.aur.aur:
    use: yay
    name: "{{ packages.shell.aur }}"
  become: true
  become_user: aur_builder

- name: Install zsh plugins via antibody
  shell:
    cmd: "antibody bundle < /home/{{ user.name }}/.zsh/plugins.txt > /home/{{ user.name }}/.zsh_plugins.sh"
    creates: "/home/{{ user.name }}/.zsh_plugins.sh"
  become: true
  become_user: "{{ user.name }}"
  tags:
    - zsh

- name: Check if fish plugins installed
  command:
    cmd: "/usr/bin/fish -c fisher list"
  become: true
  become_user: "{{ user.name }}"
  register: fish_list
  tags:
    - fish

- name: Install fish plugins via fisher
  command:
    cmd: "/usr/bin/fish -c fisher update"
  become: true
  become_user: "{{ user.name }}"
  when: not fish_list.stdout
  tags:
    - fish
